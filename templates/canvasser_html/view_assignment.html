{% extends "header.html" %}

{% block header %}
    <!-- Custom styles for this login page -->
    <link href="/static/css/view_canvasser_ass.css" rel="stylesheet">

{% endblock %}

<!----------------------BODY PART---------------------------------------------->
{% block body %}
      <h1 style="text-align: center;padding-top:10px;">Assignments</h1>
      <hr/>
    <button class="btn btn-info" type="button" style="margin-left:5%" id="canHome" onclick="window.location.href='{{ url_for( 'canvasser.canPage', u_name = session['info']['name'])}}' ">HomePage</button><br/><br/>
    <!-------------Basic Instruction--------------->
     <h4 style="margin-left:5%"><span style="padding-left:5px; font-weight: bold;">Basic Instructions : </span></h4>
     <h5 style="margin-left:10%">You have two ways to see your assigment details<br/>
        <ul>
              <li>Select from assignements list</li>
              <li> Click the location marker on the map</li>
        </ul>  
    </h5><hr/>
    <div class="row">
   <!-- ----------- Locations on the List -->
      <div class="panel panel-primary col"id="assigment_list">
        <div class="panel-heading" style="margin-left: 5%;"><h3 class="panel-title">Locations on List</h3>
        </div>
        <div class="panel-body">
          <ul class="list-group">
             {% for instance in assignments %}
            <a style="color:black !important;" class="list-group-item btn btn-info" value="{{ instance.id}}" href="{{ url_for('canvasser.view_assigment_detail', ass_id = instance.id)}}">Assignment{{instance.order}} {{assignments[instance][0]}} ({{assignments[instance][1]}},{{assignments[instance][2]}} )</a>
          {% endfor %}
        </ul>
    </div>
</div> 
<!----------------Loading locations for creating markers on Map-------->

  <div class="panel  panel-primary col" id="result_panel">
      <div class="panel-heading" style="margin-left: 5%;"><h3 class="panel-title">Locations on Map</h3>
      </div>
      <div class="panel-body">
        <div id="map" name="map" style=" height: 350px;background-color: grey"></div>
      </div>
  </div> 
</div>
<script type="text/javascript">
$(document).ready(function () {
     var locations =[];
   // Get all locations
   {% for instance in assignments %}
      var one_location=[];
     one_location.push('{{assignments[instance][0]}}', '{{assignments[instance][1]}}','{{assignments[instance][2]}}');
     locations.push(one_location);
  {% endfor %}
  // Generate Map
   var mapOptions = {
        center: new google.maps.LatLng(40.9256538, -73.140943),
        zoom: 13
    }
    map = new google.maps.Map(document.getElementById("map"), mapOptions);
        var infowindow = new google.maps.InfoWindow();

// Inital Markers
    var marker, i;
    var bounds = new google.maps.LatLngBounds();

    for (i = 0; i < locations.length; i++) { 
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        title:locations[i][0],
        map: map
      });

      bounds.extend(marker.getPosition());
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
          map.setCenter(marker.getPosition());
          map.setZoom(16);
          // If close infowindow, then go back to default mapsetting
          google.maps.event.addListener(infowindow, 'closeclick', function() {
                map.fitBounds(bounds);
          });
        }
      })(marker, i));
    }
    // Let us to see all markers together
    map.fitBounds(bounds);
    
  });
</script>
    <!-- map js files--> 
    <script  src="/static/javascript/canvasser_script/viewAssignment.js"></script> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGuEpRycbTYDCcS6uxiot0x0eSLkpTbiY&libraries=places&callback=initAutocomplete"></script>
{%  endblock %}